[Title]
What Are We Doing?

[Page]
<p>
	This page requires javascript and access to the Article Workshop. Be sure you're logged in.
</p>
<div id="wawd">
	Loading...
</div>

<script id="wawdTemplate" type="text/ractive">
	{{#isCurrentIssue()}}
	<div class="article">
		<a target="_blank" href="{{url}}">
			<div class="article {{className()}}">
				<div class="stage"><span>{{stage}}</span></div>
				<div class="title">{{title}}</div>
				<div class="section">{{section}}</div>
			</div>
		</a>
	</div>
	{{/isCurrentIssue()}}
</script>

<script type="text/javascript">
	//<![CDATA[
		(function(){
			var articles = [];
			var wawdRactive = new Ractive({
				template:'#wawdTemplate',
				el:'#wawd',
				data:articles
			});

			//----options-----
			var baseUrl = '/forums/forums/80/page-';
			var maxPages = 2;
			var sectionMap = {
				G  : 'General',
				M  : 'Metagame',
				BS : 'Battling Strategy',
				E  : 'Entertainment',
				AR : 'Arts & Recreation',
				OF : 'Other Features'
			};
			var stageMap = {
				WIP     : 0,
				Grammar : 1,
				HTML    : 2,
				Images  : 3,
				Done    : 4
			};
			//----/options-----

			var Article = function(){ this.url = '#'; this.title = ''; this.section = 'Unown'; this.stage = 'Unown'; this.stageInt = -1; };
			Article.prototype.currentIssue = Infinity;
			Article.prototype.isCurrentIssue = function(){
				return this.currentIssue === this.issueNumber;
			};
			Article.prototype.className = function(){
				return this.section.replace('/ /g', '-').replace(/\&/g,'and').toLowerCase() + ' ' + this.stage.toLowerCase();
			};

			function getSectionName(shorthand){
				return sectionMap.hasOwnProperty(shorthand) ? sectionMap[shorthand] : 'Unown';
			};

			function parseTitle(title) {
				var components = {};
				var sections = title.split(/[\[\]]/g);

				if(sections.length > 1){
					components.section     = getSectionName(section[1].split('-')[1]);
					components.issueNumber = getSectionName(section[1].split('-')[0]);
					components.title = sections[2];
				} else {
					components.title = sections[0];
					components.section = 'Unown';
					components.issueNumber = Infinity;
				}

				return components;
			};

			function parseElement(e){
				var article = new Article();

				try {
					var titleComponents = parseTitle(e.querySelector('.title [data-previewurl]').innerHTML);

					article.url      = '/forums/threads/' + e.id.replace('thread-', '');
					article.title    = titleComponents.title;
					article.section  = titleComponents.section;
					article.stage    = e.querySelector('.prefixPrimary').innerHTML;
					article.stageInt = stageMap[article.stage];
				} catch(ex) {
					err = e;
				}

				return article;
			};

			

			//load pages
			var minIssue, article;
			for(var i = 1; i <= maxPages; i++) {
				//create a closure to prevent some strange async errors
				(function(index){
					$.ajax({
						url:baseUrl + index,
						cache:false,
						dataFilter:function(data){
							//remove images before loading the html
							data = data.replace(/src\=\"/gi, "\"");
							//these are the prefixes for wip, grammar, html, images and done
							$(data).find('.prefix21,.prefix73,.prefix62,.prefix81,.prefix87').not('.sticky,.deleted').each(function(){
								article = parseElement(this);
								if(article.issueNumber < minIssue) { minIssue = article.issueNumber; }
								articles.push(article);
							});
						}
					});
				})(i);
			}
		})();
	//]]>
</script>

[Head]
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript" src="http://cdn.ractivejs.org/latest/ractive.min.js"></script>

<style type="text/css">
	#wawd { border:1px solid #CCC; border-width:1px 0; margin-left:16px; }
	.article { padding:2px; color:#333; }
	.article:hover { background-color:#608; color:white; }
	.article div { display:inline-block; }
	.article .title { width:576px; font-weight: bold; }
	.article .section { width:128px; }
	.article .stage { color:#333 !important; width:80px; text-align:center; padding:6px 8px; font-weight:bold;margin-right:8px; }

	.wip .stage { background-color:#F88; }
	.images .stage { background-color:#FBF; }
	.grammar .stage { background-color:#FC8; }
	.html .stage { background-color:#BBF; }
	.done .stage { background-color:#DDE; }
</style>