[TITLE]
Help Form

[HEAD]
<script type="text/javascript">
	//messages will go to this user if no one is found for a particular subject
	var defaultRecipient = 'Toast++, Redew, skylight, Darnell, Xylen';

	//this value is used to determine how many redundant people a message should
	//be sent to. A setting of 1 would send to 1 person + 1 redundant person for
	//a total of 2 recipients;
	var redundancy = 1;

	//If you need to use a single quote as part of a subject or name, it must 
	//be escaped. Just place a \ before the ' as in: I\'m showing an example.
	var subjects = {
		'The Basics of Pokemon Battling' : ['EonX', 'King UU', 'CyclicCompound', 'Sashay', 'AM', 'Metal Sonic', 'Plus', 'Darnell', 'Valentine', 'Eevee General', 'Trinitrotoluene', 'Bean', 'xzern', 'Albacore', 'Zebraiken', 'Aragorn the King', 'Jukain', 'Andrew', 'Magnemite', 'ScraftyIsTheBest', 'Steven Snype', 'Soulgazer', 'LightningLuxray', 'Valmanway', 'galbia', 'scorpdestroyer', 'Pwnemon', 'TRC', 'Aenonar', 'Water Drone', 'Mambo'],
		'How to Get Involved in Different Tiers' : ['Sashay', 'CyclicCompound', 'Albacore', 'Zebraiken', 'Arikado', 'xzern', 'Magnemite', 'ScraftyIsTheBest', 'Soulgazer', 'galbia', 'scorpdestroyer', 'Pwnemon', 'TRC', 'EonX', 'Aragorn the King', 'Water Drone'],
		'Team Rating' : ['Royalty', 'Superpowerdude', 'Subject 18', '-Tsunami-', 'Trinitrotoluene', 'Brawlfest', 'dragonuser', 'Electrolyte', 'Jirachee', 'Nova', 'TheEnder', 'Joeyboy', 'Valentine', 'Plus', 'Soulgazer', 'Tomahawk', 'Zebraiken', 'Aragorn the King'],
		'Tournaments' : ['Enguarde', 'Nova', 'Laga', 'cbt', 'FireMage', 'Valentine', 'Hugendugen', 'MikeDecIsHere', 'Sapientia', 'Tomahawk', 'Zebraiken', 'Steven Snype', 'Lasagne', 'TRC'],
		'How to Write a Pokemon Analyses' : ['Ace Emerald', 'Raseri', 'Zebraiken', 'Alter', 'Arikado', 'scorpdestroyer', 'ScraftyIsTheBest', 'Audiosurfer', 'col49', 'Pwnemon', 'Hollywood', 'darkie', 'Rohail', 'Rowan', 'Electrolyte', 'CyclicCompound', 'EonX', 'TRC', 'Jukain', 'Sashay', 'horyzhnz', 'malefic', 'prem', 'Metal Sonic', 'LightningLuxray', 'NixHex', 'Magcargo', 'Soulgazer', 'Magnemite', 'Mambo'],
	    'How to get involved with grammar checking on Smogon' : ['Calm Pokemaster', 'Electrolyte', 'Jellicent', 'Redew', 'horyzhnz', 'GatoDelFuego', 'Sashay', 'Rohail', 'Jukain', 'Steven Snype'],
	    'Programming or HTMLing' : ['Redew', 'Toast++', 'Vacate', 'Jukain', 'TRC', 'Antemortem', 'Timbuktu'], 
	    'The Social Areas of Smogon' : ['Coronis', 'Da Letter El', 'RODAN', 'zorbees', '-Tsunami-', 'Spydreigon', 'cbt', 'Lasagne', 'Pwnemon'],
	    'IRC Culture' : ['Hollywood', 'Magnemite', 'RODAN'],
	    'Art' : ['Andrew', 'Bummer', 'RitterCat', 'Regime', 'faxxifer'], 
	    'Orange Islands' : ['DHR-107', 'Hulavuta', 'Jellicent'], 
	    'Wi-Fi' : ['Toast++', '.com'], 
	    'Create-A-Pokemon' : ['Birkal', 'darkie', 'DHR-107', 'srk1214'], 
	    'Anime Style Battling' : ['Pwnemon', 'Birkal'], 
	    'Social Media' : ['EonX', 'Ace Emerald', 'darkie', 'Darnell', 'Zodiax', 'shaymin', 'Trinitrotoluene', 'TRC'], 
	    'How to Get Started With The Competitor' : ['EonX', 'Toast++', 'FireMage', 'Redew', 'Jellicent', 'Valentine'], 
	    'How to Get Started With The Smog' : ['Superpowerdude', 'Electrolyte', 'Calm Pokemaster', 'EonX', 'Sashay', 'Bummer', 'blizzardy', 'Toast++', 'Pwnemon', 'Tomahawk', 'Valmanway', 'Flora', 'Redew', 'Jellicent', 'Hulavuta', 'Jukain', 'unfixable', 'Trinitrotoluene', 'TRC', 'Regime', 'RitterCat', 'Birkal', 'Darnell', 'skylight', 'Spydreigon'], 
	    'How to Get Started With The Player' : ['Blitzamirin', 'Antemortem', 'Zodiax', 'Electrolyte', 'shaymin', 'Sashay', 'Scene', 'Spydreigon', 'SteelEdges', 'Vacate', 'Redew', 'unfixable', 'Regime', 'Darnell'],
	    'The Basics of Pokemon Showdown' : ['Alter', 'Skitty', 'Antemortem', 'Blitzamirin', 'Electrolyte', 'Bean', 'Hugendugen', 'Albacore', 'zfs', 'Spydreigon', 'Darnell', 'Enguarde', 'sirDonovan', 'Coronis', 'SteelEdges', 'CrushinDefeat', 'Hollywood', 'Pandon', 'Timbuktu', 'MikeDecIsHere', 'Royalty', 'prem', 'skylight', 'Shame That', 'shaymin', 'Vacate', 'Scene', 'Sashay', 'Test2017', 'Audiosurfer', 'Trinitrotoluene', 'Scotteh', 'King UU']
	};
</script>

<style type="text/css">
	.message-zone div { border-radius:5px; padding:5px 15px 5px 30px; margin:4px 0; }
	.message-zone p { margin-bottom:0; }
	.message-zone div.error { background-color:#ffe0e0; border:1px solid #8c2f2f; color:#8c2f2f; }
	.message-zone div.success { background-color:#e4ffe0; border:1px solid #128405; color:#128405; }

	#contact { margin-top:16px; }
	#contact label { display:block; }
	#contact select, #contact textarea { display:block; padding:4px 8px; border:1px solid #CCC; border-radius:4px; margin:8px 0px; width:512px; }
	#contact textarea { height:256px; }
	#contact button { border-radius:3px; border:1px solid #ccc; padding:4px 12px; cursor:pointer; }
	#contact button:hover { background-color:#eee; }
</style>


[PAGE]
<div class="message-zone"></div>
<form id="contact">
	<label for="subject">What do you need help with?</label>
	<select name="subject">
		<option>loading...</option>
	</select>
	<label for="message">What's your question?</label>
	<textarea name="message"></textarea>
	<button name="submit" type="submit">Send</button>
</form>

<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="https://dl.dropboxusercontent.com/u/18231634/Smogon/scripts/smogon-messager.js"></script>
<script type="text/javascript">
	(function(){
		var helpMessage = new Message();

		//load in options
		var opts = '';
		for(var subject in subjects) {
			opts += ('<option>' + subject + '</option>');
		}
		$('#contact [name="subject"]').html(opts);

		//gets random recipients or default if none found
		var getRecipientForSubject = function(subject){
			var user = defaultRecipient;

			if(subjects[subject] != undefined && subjects[subject].length > 0) {
				var index = Math.floor(Math.random() * subjects[subject].length);
				var redundantCount = 0;

				user = subjects[subject][index];
				subjects[subject].splice(index, 1);

				while(subjects[subject].length > 0 && redundantCount < redundancy) {
					index = Math.floor(Math.random() * subjects[subject].length);
					user += (', ' + subjects[subject][index]);
					subjects[subject].splice(index, 1);
					redundantCount++;
				}
			} else {
				helpMessage.message = 'No users found to help:<br/><br/>' + helpMessage.message;
			}

			return user;
		};

		//shows a message to the user
		var showMessage = function(type, message) {
			var m = '<div class="{0}"><p>{1}</p></div>';
			$('.message-zone').html(m.replace('{0}', type).replace('{1}', message));
		};

		$(function(){
			//not logged in or other problems
			helpMessage.prepare(function(res){
				if(!res.success){
					showMessage('error', res.info);
				}
			});

			//send message on submit
			$('#contact').on('submit', function(evt){
				evt.preventDefault();
				$('button', this).hide();

				var subject = $('#contact [name="subject"]').val();

				helpMessage.title = '[Help Request] ' + subject;
				helpMessage.message = $('#contact [name="message"]').val();
				helpMessage.to = getRecipientForSubject(subject);

				helpMessage.send(function(res){
					if(res.success){
						showMessage('success', res.info + ' Go back to <a href="/forums/">the forums</a>?');
					} else {
						showMessage('error', res.info);
					}
				});
			});
		});
	})();
</script>